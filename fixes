Fixes applied to cto-frontend-old-fresh

1) Privy payment endpoints were missing JWT
What was wrong
- Backend requires JwtAuthGuard for Privy payment routes, but the test frontend did not send Authorization headers.
- Calls failed with 401 even after successful login.

What I changed (test frontend)
- File: cto-frontend-old-fresh/src/services/privyPaymentService.ts
- Added reading cto_auth_token from localStorage.
- Added Authorization: Bearer <token> headers to:
  - POST /api/v1/payment/privy/listing
  - POST /api/v1/payment/privy/verify/:paymentId
- Throws a clear error if token is missing.

How to implement the same fix in main-cto-frontend
- File: main-cto-frontend/src/services/privyPaymentService.ts
- Add the same Authorization header logic using cto_auth_token.
- Keep existing API paths (main frontend uses /api/payment/privy/...)

Reference snippet (logic only):
const token = localStorage.getItem('cto_auth_token');
if (!token) throw new Error('No authentication token');
headers: {
  'Content-Type': 'application/json',
  Authorization: `Bearer ${token}`,
}

2) Privy payment moved to legacy and removed from UI
What was changed
- File moved: cto-frontend-old-fresh/src/services/privyPaymentService.ts -> cto-frontend-old-fresh/src/legacy/privyPaymentService.ts
- File updated: cto-frontend-old-fresh/src/components/Payment/ListingPayment.tsx
  - Removed Privy EVM + Circle payment paths and UI selector.
  - Movement payment is now the only active flow in the UI.
  - Manual verify uses Movement payment verify with the saved txHash.

How to implement the same in main-cto-frontend
- Move or archive the Privy EVM/Circle payment UI so only Movement is selectable.
- Keep any legacy payment service in a legacy folder if needed for reference.

3) Movement-only pricing in test frontend (remove Circle pricing fetch)
What was changed
- File moved to legacy: cto-frontend-old-fresh/src/services/paymentService.ts -> cto-frontend-old-fresh/src/legacy/paymentService.ts
- File updated: cto-frontend-old-fresh/src/components/UserListings/MyUserListings.tsx
  - Removed pricing fetch from /api/v1/payment/pricing
  - Removed listingPrice state (now fixed to 1.0 USDC in UI text)

How to implement the same in main-cto-frontend
- Remove calls to /api/payment/pricing (Circle pricing) from My Listings UI.
- Hardcode 1.0 USDC display (or read Movement listing amount from backend if you add an endpoint).

Backend note (for backend devs)
- Privy/Circle payment controllers/services moved to legacy and removed from PaymentModule.
- Active payments are Movement-only now.

4) Presentable listings rotation removed (manual curation only)
What was changed
- File: cto-backend-old-fresh/src/listing/workers/refresh.worker.ts
  - Removed disabled dailyRotation() method (was commented out with @Cron disabled)
  - Removed disabled enforceTokenLimitRotation() method
  - Updated comments to clarify: "Tokens are manually managed via POST /api/listing/add"
  - No automatic deletion or rotation - all tokens are manually curated

Current behavior
- Tokens are added manually via POST /api/listing/add endpoint
- No automatic daily rotation or token limit enforcement
- Manual curation model (as per user requirement)

Documentation
- Any docs mentioning "25 tokens, daily rotation" should be updated to reflect manual curation model

5) EVM trading enabled for Base, Ethereum, and BSC in test frontend
What was changed
- File: cto-frontend-old-fresh/src/components/Listing/ListingDetail.tsx
  - Trading buttons enabled only for Base/Ethereum/BSC/Movement.
  - Solana/Sui/BSC (when not enabled) show "Trading Coming Soon".
  - Base/Ethereum/BSC use Privy EVM wallet and 1inch build flow.
- File: cto-frontend-old-fresh/src/utils/walletRouter.ts
  - Chain routing expanded to include ETHEREUM and BSC.
  - EVM send uses eth_sendTransaction and then reports txHash to backend.

How the EVM trade flow works (Base/ETH/BSC)
1) Frontend calls POST /api/v1/trades/quote with chain=base|ethereum|bsc
2) Frontend calls POST /api/v1/trades/build-transaction with chain=base|ethereum|bsc
3) User signs via Privy EVM wallet (eth_sendTransaction)
4) Frontend reports txHash to backend (POST /api/v1/trades/execute)

How to implement the same in main-cto-frontend
- Update trade button gating to enable Base/Ethereum/BSC/Movement only.
- Use the same chain keys: base, ethereum, bsc (lowercase) when calling backend.
- Use Privy EVM wallet for Base/ETH/BSC; ensure network switching for Base (8453), Ethereum (1), BSC (56).

6) Trade table parsing + formatting fixes
What was changed
- File: cto-frontend-old-fresh/src/services/listingService.ts
  - Unwraps nested response: response.data.data.data if present.
- File: cto-frontend-old-fresh/src/components/Listing/ListingDetail.tsx
  - Dedupe by txHash to avoid duplicate rows.
  - Display '—' for missing price/amount/totalValue instead of 0.0000.
  - Updated explorer links based on chain (BaseScan/Etherscan/BscScan).

Why some tokens show "No trades yet"
- Upstream providers (Birdeye/DexScreener/Helius) sometimes return empty or rate-limited data.
- Some tokens genuinely have no indexed trades yet.
- Duplicates are from upstream; we now dedupe by txHash.

7) User-facing error messaging for EVM insufficient gas
What was changed
- Backend now returns 1inch error descriptions to the client.
- Frontend displays the error so users see "Not enough ETH balance" instead of a generic 400.

How to implement in main-cto-frontend
- Surface error message from backend response data.description if present.

8) DexScreener-style live trades via WebSocket (server-side polling)
What was changed
- Backend: added trades websocket gateway at /ws with events:
  - trades.subscribe { tokenAddress, chain, limit }
  - trades.update { tokenAddress, chain, trades, timestamp }
  - trades.unsubscribe { tokenAddress, chain }
- Backend: /api/v1/tokens/:address/trades now accepts chain query param.
- Frontend: ListingDetail subscribes to trades.update and uses fallback polling if WS disconnects.
- Frontend: trade fetch includes chain so Base/ETH/BSC/Solana/Movement/Sui resolve correctly.

How it works
- Server polls upstream sources every 5s per active token room and broadcasts trades to connected clients.
- Client receives normalized trades and renders them like DexScreener (Buy/Sell, price, amount, maker, time).

How to implement in main-cto-frontend
- Add Socket.IO subscription on ListingDetail:
  - on connect emit trades.subscribe with tokenAddress + chain
  - on disconnect fallback to polling /tokens/:address/trades?chain=...
  - on unmount emit trades.unsubscribe
- Update listingService.getTokenTrades to accept chain param.

Notes
- Sui trades currently return empty (no upstream support yet).
- Solana uses Helius/Birdeye, Base/ETH/BSC use Birdeye fallback. Movement uses Sentio DB/webhook.

9) Trade timestamp now shows time-ago
What was changed
- ListingDetail now renders trade timestamps as "5m ago" with the full timestamp in a tooltip.

How to implement in main-cto-frontend
- Add a formatTimeAgo helper and render time-ago in the trades list.
